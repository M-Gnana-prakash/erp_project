<div class="relative w-80 calendar-wrapper">
  @if (label) {
  <label [class]="{
            'text-xs': computedStyles.sizeVariant === 'sm',
            'text-sm': computedStyles.sizeVariant === 'md',
            'text-base': computedStyles.sizeVariant === 'lg'
        }" [style.color]="computedStyles.labelColor" class="font-medium mb-1 block">
    {{ label }} @if(required){<span class="text-red-500">*</span>}
  </label>
  }

  <!-- Input -->
  <div class="relative">
    <input [disabled]="disabled" readonly (click)="toggle()" [value]="format(start) + (end ? ' â€“ ' + format(end) : '')"
      placeholder="Enter a date range" class="w-full focus:outline-none transition-all duration-200"
      [style.border]="computedStyles.borderStyle" [style.background-color]="computedStyles.backgroundColor"
      [style.color]="computedStyles.textColor" [ngClass]="{
          'px-2 py-1 text-xs': computedStyles.sizeVariant === 'sm',
          'px-3 py-2 text-sm': computedStyles.sizeVariant === 'md',
          'px-4 py-3 text-base': computedStyles.sizeVariant === 'lg',
          'opacity-50 cursor-not-allowed': disabled,
          'rounded': true
      }" />

    <span (click)="toggle()" class="absolute right-3 top-1/2 -translate-y-1/2 text-blue-600 cursor-pointer"
      [style.color]="computedStyles.selectedColor">
      ðŸ“…
    </span>
  </div>

  <!-- Validation -->
  @if (needValidationStatusMessage && errors.length > 0 && isTouched) {
  <div class="mt-1">
    @for (error of errors; track error) {
    <p class="text-red-500 text-xs mt-0.5">
      {{ error }}
    </p>
    }
  </div>
  }

  <!-- Popup -->
  <div *ngIf="show" class="absolute z-50 mt-2 bg-white rounded-lg shadow-xl w-80 overflow-hidden">

    <!-- Header -->
    <div class="bg-gray-100 px-4 py-3 flex justify-between items-center">

      <div class="flex items-center gap-2 font-semibold text-gray-700">

        <select class="border rounded px-2 py-1 text-sm" [value]="current.getMonth()"
          (change)="setMonth($any($event.target).value)">

          <option *ngFor="let m of months; let i = index" [value]="i">
            {{ m }}
          </option>

        </select>

      </div>

      <div class="flex gap-4 text-gray-600">
        <button type="button" (click)="change(-1)"
          class="w-8 h-8 flex items-center justify-center hover:bg-gray-200 rounded-full transition-colors text-xl font-bold">â€¹</button>
        <button type="button" (click)="change(1)"
          class="w-8 h-8 flex items-center justify-center hover:bg-gray-200 rounded-full transition-colors text-xl font-bold">â€º</button>
      </div>

    </div>

    <!-- Weekdays -->
    <div class="grid grid-cols-7 text-center text-xs text-gray-500 py-2 border-b">
      <div *ngFor="let d of ['S','M','T','W','T','F','S']">
        {{ d }}
      </div>
    </div>

    <!-- Dates -->
    <div class="grid grid-cols-7 text-center p-3 gap-y-2 text-sm">

      <div *ngFor="let d of days" (click)="select(d)" class="relative cursor-pointer">

        <!-- Range background -->
        <div *ngIf="inRange(d)" class="absolute inset-0" [style.background-color]="computedStyles.selectedColor"
          style="opacity: 0.1">
        </div>

        <!-- Date circle -->
        <div
          class="relative z-10 w-8 h-8 mx-auto flex items-center justify-center rounded-full transition-colors duration-200"
          [ngClass]="{
            'text-white': isEdge(d),
            'hover:bg-gray-100': !isEdge(d)
          }" [style.background-color]="isEdge(d) ? computedStyles.selectedColor : 'transparent'">
          {{ d.getDate() }}
        </div>

      </div>

    </div>

  </div>

</div>